<!DOCTYPE html>
<html>
  <head>
    <title>Storefront SDK Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      button {
        padding: 10px 20px;
        margin: 10px 0;
        cursor: pointer;
      }
      #result {
        margin-top: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>Storefront SDK Test</h1>

    <div>
      <label for="apiKey">API Key:</label>
      <input
        type="text"
        id="apiKey"
        style="width: 300px"
        placeholder="Enter your API key"
      />
    </div>

    <div>
      <label for="skuId">SKU ID:</label>
      <input
        type="text"
        id="skuId"
        style="width: 300px"
        placeholder="Enter SKU ID"
      />
    </div>

    <div>
      <label for="userReferenceId">User Reference ID:</label>
      <input
        type="text"
        id="userReferenceId"
        style="width: 300px"
        placeholder="Enter user reference ID"
      />
    </div>

    <button onclick="getSku()">Get SKU Details</button>
    <button onclick="purchaseSku()">Purchase SKU</button>

    <div id="result"></div>

    <script>
      var StorefrontModule = (function (e) {
        'use strict';
        function t(e, t, n, o) {
          return new (n || (n = Promise))(function (s, i) {
            function r(e) {
              try {
                a(o.next(e));
              } catch (e) {
                i(e);
              }
            }
            function l(e) {
              try {
                a(o.throw(e));
              } catch (e) {
                i(e);
              }
            }
            function a(e) {
              var t;
              e.done
                ? s(e.value)
                : ((t = e.value),
                  t instanceof n
                    ? t
                    : new n(function (e) {
                        e(t);
                      })).then(r, l);
            }
            a((o = o.apply(e, t || [])).next());
          });
        }
        function n(e, t, n) {
          (e.style.opacity = '0'),
            t && (t.style.transform = 'scale(0.95)'),
            n &&
              ((n.style.transform = 'scale(0.8) rotate(180deg)'),
              (n.style.opacity = '0'));
        }
        var o;
        'function' == typeof SuppressedError && SuppressedError,
          (e.Environment = void 0),
          ((o = e.Environment || (e.Environment = {})).Development =
            'Development'),
          (o.Production = 'Production');
        class s {
          constructor(e) {
            (this.skipCloseConfirmation = !1),
              (this.isApiKeyValid = !1),
              (this.isConfirmationDialogOpen = !1),
              console.log('create config', e),
              (this.config = e);
          }
          listSkus(e) {
            return t(this, void 0, void 0, function* () {
              return (function (e, n, o, s) {
                return t(this, void 0, void 0, function* () {
                  const t = new URLSearchParams();
                  n && t.append('page', n.toString()),
                    o && t.append('perPage', o.toString()),
                    (null == s ? void 0 : s.priceLessThan) &&
                      t.append('priceLessThan', s.priceLessThan),
                    (null == s ? void 0 : s.priceGreaterThan) &&
                      t.append('priceGreaterThan', s.priceGreaterThan),
                    (null == s ? void 0 : s.nameContains) &&
                      t.append('nameContains', s.nameContains),
                    (null == s ? void 0 : s.type) && t.append('type', s.type),
                    (null == s ? void 0 : s.collectionId) &&
                      t.append('collectionId', s.collectionId);
                  const i = yield fetch(
                    `https://api.gameshift.dev/internal/storefront/skus-with-inventory?${t.toString()}`,
                    {
                      method: 'GET',
                      headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': e,
                      },
                    },
                  );
                  return i.ok
                    ? { success: !0, data: yield i.json() }
                    : { success: !1, error: 'Failed to fetch SKUs' };
                });
              })(
                this.config.apiKey,
                null == e ? void 0 : e.page,
                null == e ? void 0 : e.perPage,
                e,
              );
            });
          }
          getSku(e) {
            return t(this, void 0, void 0, function* () {
              return (function (e, n) {
                return t(this, void 0, void 0, function* () {
                  const t = yield fetch(
                    `https://api.gameshift.dev/nx/storefront/skus/${n}`,
                    {
                      method: 'GET',
                      headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': e,
                      },
                    },
                  );
                  return t.ok
                    ? { success: !0, data: yield t.json() }
                    : { success: !1, error: 'Failed to fetch SKU' };
                });
              })(this.config.apiKey, e);
            });
          }
          purchaseSkuImmediately(e) {
            return t(this, void 0, void 0, function* () {
              const t = yield fetch(
                `https://api.gameshift.dev/internal/storefront/skus/${e.skuId}/purchase`,
                {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': this.config.apiKey,
                  },
                  body: JSON.stringify({
                    quantity: e.quantity || 1,
                    userReferenceId: e.userReferenceId,
                    vendorData: e.vendorData,
                  }),
                },
              );
              if (!t.ok)
                return {
                  success: !1,
                  status: 'failed',
                  error: 'Failed to create cart and purchase SKU',
                };
              const n = yield t.json();
              console.log('responseJson', n);
              const o = yield this.renderIframe(n.consentUrl);
              return o.success
                ? {
                    success: !0,
                    data: {
                      skuId: e.skuId,
                      quantity: e.quantity || 1,
                      transactionId: n.id,
                    },
                  }
                : {
                    success: !1,
                    status: 'failed',
                    error:
                      (null == o ? void 0 : o.error) ||
                      'Purchase was cancelled or failed',
                  };
            });
          }
          renderIframe(e) {
            return t(this, void 0, void 0, function* () {
              return new Promise((n, o) =>
                t(this, void 0, void 0, function* () {
                  const t = document.createElement('div');
                  (t.style.position = 'fixed'),
                    (t.style.top = '0'),
                    (t.style.left = '0'),
                    (t.style.width = '100%'),
                    (t.style.height = '100%'),
                    (t.style.backgroundColor = 'rgba(0, 0, 0, 0.5)'),
                    (t.style.zIndex = '9998'),
                    document.body.appendChild(t);
                  const o = this.createModal(),
                    s = this.createIframe(e),
                    i = this.createCloseButton(o, n);
                  o.appendChild(s),
                    o.appendChild(i),
                    document.body.appendChild(o),
                    (function (e, t, n) {
                      requestAnimationFrame(() => {
                        (e.style.backgroundColor = 'rgba(0,0,0,0.5)'),
                          (e.style.opacity = '1'),
                          (t.style.width = '80%'),
                          (t.style.height = '80%'),
                          n &&
                            ((n.style.opacity = '1'),
                            (n.style.transform = 'scale(1)'));
                      });
                    })(o, s, i),
                    window.addEventListener(
                      'message',
                      this.handleIframeMessage(o, s, i, n, t),
                    );
                }),
              );
            });
          }
          createModal() {
            const e = document.createElement('div');
            return (
              (function (e) {
                (e.style.position = 'fixed'),
                  (e.style.top = '0'),
                  (e.style.left = '0'),
                  (e.style.width = '100%'),
                  (e.style.height = '100%'),
                  (e.style.backgroundColor = 'rgba(0,0,0,0)'),
                  (e.style.display = 'flex'),
                  (e.style.alignItems = 'center'),
                  (e.style.justifyContent = 'center'),
                  (e.style.zIndex = '9999'),
                  (e.style.opacity = '0'),
                  (e.style.transition = 'all 0.3s ease-in-out'),
                  (e.style.fontFamily = 'Inter, sans-serif');
              })(e),
              e.addEventListener('click', (t) => {
                t.target === e && this.closeModal(e);
              }),
              e
            );
          }
          createIframe(e) {
            const t = document.createElement('iframe');
            return (
              (function (e) {
                (e.style.width = '0'),
                  (e.style.height = '0'),
                  (e.style.border = '1px solid rgba(0,0,0,0.1)'),
                  (e.style.borderRadius = '8px'),
                  (e.style.transition = 'all 0.3s ease-in-out'),
                  (e.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)'),
                  (e.src = 'https://gameshift.dev/');
              })(t),
              console.log('checkoutUrl', e),
              (t.src = e),
              (t.title = 'withdraw'),
              t
            );
          }
          createCloseButton(e, t) {
            const n = document.createElement('button');
            return (
              (function (e) {
                (e.innerHTML = '×'),
                  (e.style.position = 'fixed'),
                  (e.style.right = '20px'),
                  (e.style.top = '20px'),
                  (e.style.width = '40px'),
                  (e.style.height = '40px'),
                  (e.style.borderRadius = '50%'),
                  (e.style.backgroundColor = 'white'),
                  (e.style.border = 'none'),
                  (e.style.fontSize = '24px'),
                  (e.style.cursor = 'pointer'),
                  (e.style.display = 'flex'),
                  (e.style.alignItems = 'center'),
                  (e.style.justifyContent = 'center'),
                  (e.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)'),
                  (e.style.transition = 'all 0.2s ease-in-out'),
                  (e.style.opacity = '0'),
                  (e.style.transform = 'scale(0.8)'),
                  (e.style.fontFamily = 'Inter, sans-serif'),
                  (e.style.lineHeight = '0'),
                  (e.style.paddingBottom = '4px');
              })(n),
              n.addEventListener('mouseover', () => {
                (n.style.transform = 'scale(1.1)'),
                  (n.style.backgroundColor = '#f0f0f0');
              }),
              n.addEventListener('mouseout', () => {
                (n.style.transform = 'scale(1)'),
                  (n.style.backgroundColor = 'white');
              }),
              n.addEventListener('click', () => this.closeModal(e, t)),
              n
            );
          }
          handleIframeMessage(e, t, o, s, i) {
            return (r) => {
              'iframe-result' === r.data.type &&
                (n(e, t, o),
                setTimeout(() => {
                  document.body.removeChild(e),
                    document.body.removeChild(i),
                    s({ success: !0, data: r.data.result });
                }, 300));
            };
          }
          closeModal(e, t) {
            if (this.skipCloseConfirmation) {
              n(e);
              const o = document.querySelector(
                'div[style*="rgba(0, 0, 0, 0.5)"]',
              );
              setTimeout(() => {
                document.body.removeChild(e),
                  o && document.body.removeChild(o),
                  t &&
                    t({
                      success: !1,
                      error:
                        'User closed the purchase window before completion',
                    });
              }, 300);
            } else
              this.isConfirmationDialogOpen ||
                this.showConfirmationDialog(e, t);
          }
          showConfirmationDialog(e, t) {
            this.isConfirmationDialogOpen = !0;
            const n = document.createElement('div');
            (n.style.position = 'fixed'),
              (n.style.top = '0'),
              (n.style.left = '0'),
              (n.style.width = '100%'),
              (n.style.height = '100%'),
              (n.style.backgroundColor = 'rgba(0, 0, 0, 0.5)'),
              (n.style.zIndex = '9999'),
              (n.style.pointerEvents = 'all'),
              e.appendChild(n);
            const o = document.createElement('div');
            !(function (e) {
              (e.style.position = 'fixed'),
                (e.style.top = '50%'),
                (e.style.left = '50%'),
                (e.style.transform = 'translate(-50%, -50%) scale(0.9)'),
                (e.style.backgroundColor = '#1a1a1a'),
                (e.style.padding = 'min(20px, 3vw)'),
                (e.style.borderRadius = '12px'),
                (e.style.boxShadow = '0 8px 32px rgba(0,0,0,0.5)'),
                (e.style.zIndex = '10000'),
                (e.style.textAlign = 'center'),
                (e.style.opacity = '0'),
                (e.style.transition = 'all 0.2s ease-out'),
                (e.style.width = 'min(90%, 360px)'),
                (e.style.maxHeight = '90vh'),
                (e.style.overflowY = 'auto'),
                (e.style.fontFamily = 'Inter, sans-serif'),
                (e.style.border = '1px solid rgba(255,255,255,0.1)'),
                (e.style.backdropFilter = 'blur(10px)');
            })(o),
              (o.style.zIndex = '10000');
            const s = document.createElement('p');
            !(function (e) {
              (e.textContent =
                'Are you sure you want to close this window? Your progress will be lost.'),
                (e.style.marginBottom = 'min(20px, 3vw)'),
                (e.style.fontSize = 'clamp(14px, 2.5vw, 15px)'),
                (e.style.lineHeight = '1.5'),
                (e.style.color = '#ffffff'),
                (e.style.fontFamily = 'Inter, sans-serif'),
                (e.style.fontWeight = '400');
            })(s);
            const i = document.createElement('div');
            !(function (e) {
              (e.style.display = 'flex'),
                (e.style.justifyContent = 'center'),
                (e.style.gap = 'min(12px, 2vw)'),
                (e.style.flexWrap = 'wrap'),
                (e.style.fontFamily = 'Inter, sans-serif');
            })(i);
            const r = this.createConfirmationButton(!0, () => {
                (o.style.opacity = '0'),
                  (o.style.transform = 'translate(-50%, -50%) scale(0.9)'),
                  setTimeout(() => {
                    document.body.removeChild(o),
                      e.removeChild(n),
                      (this.isConfirmationDialogOpen = !1),
                      (this.skipCloseConfirmation = !0),
                      this.closeModal(e, t);
                  }, 200);
              }),
              l = this.createConfirmationButton(!1, () => {
                (o.style.opacity = '0'),
                  (o.style.transform = 'translate(-50%, -50%) scale(0.9)'),
                  setTimeout(() => {
                    document.body.removeChild(o),
                      e.removeChild(n),
                      (this.isConfirmationDialogOpen = !1);
                  }, 200);
              });
            i.appendChild(l),
              i.appendChild(r),
              o.appendChild(s),
              o.appendChild(i),
              document.body.appendChild(o),
              requestAnimationFrame(() => {
                (o.style.opacity = '1'),
                  (o.style.transform = 'translate(-50%, -50%) scale(1)');
              });
          }
          createConfirmationButton(e, t) {
            const n = document.createElement('button');
            return (
              (function (e, t) {
                (e.textContent = t ? 'Yes, close' : 'Cancel'),
                  (e.style.padding = 'min(10px, 2vw) min(20px, 4vw)'),
                  (e.style.backgroundColor = t ? '#dc2626' : '#27272a'),
                  (e.style.color = 'white'),
                  (e.style.border = '1px solid ' + (t ? '#ef4444' : '#3f3f46')),
                  (e.style.borderRadius = '6px'),
                  (e.style.cursor = 'pointer'),
                  (e.style.fontSize = 'clamp(12px, 2.5vw, 14px)'),
                  (e.style.fontWeight = '500'),
                  (e.style.transition = 'all 0.2s ease'),
                  (e.style.margin = '4px'),
                  (e.style.fontFamily = 'Inter, sans-serif');
              })(n, e),
              n.addEventListener('mouseover', () => {
                (n.style.backgroundColor = e ? '#c82333' : '#5a6268'),
                  (n.style.transform = 'translateY(-1px)');
              }),
              n.addEventListener('mouseout', () => {
                (n.style.backgroundColor = e ? '#dc3545' : '#6c757d'),
                  (n.style.transform = 'translateY(0)');
              }),
              (n.onclick = t),
              n
            );
          }
        }
        return (
          (window.Storefront = s),
          (window.Environment = e.Environment),
          (e.Storefront = s),
          Object.defineProperty(e, '__esModule', { value: !0 }),
          e
        );
      })({});
    </script>

    <script>
      let storefront;

      function initializeStorefront() {
        const apiKey = document.getElementById('apiKey').value;
        if (!apiKey) {
          alert('Please enter an API key');
          return null;
        }
        return new Storefront({
          apiKey: apiKey,
          environment: Environment.Development,
        });
      }

      async function getSku() {
        storefront = initializeStorefront();
        if (!storefront) return;

        const skuId = document.getElementById('skuId').value;
        if (!skuId) {
          alert('Please enter a SKU ID');
          return;
        }

        try {
          const result = await storefront.getSku(skuId);
          document.getElementById('result').textContent = JSON.stringify(
            result,
            null,
            2,
          );
        } catch (error) {
          document.getElementById('result').textContent =
            'Error: ' + error.message;
        }
      }

      async function purchaseSku() {
        storefront = initializeStorefront();
        if (!storefront) return;

        const skuId = document.getElementById('skuId').value;
        const userReferenceId =
          document.getElementById('userReferenceId').value;

        if (!skuId || !userReferenceId) {
          alert('Please enter both SKU ID and User Reference ID');
          return;
        }

        try {
          const result = await storefront.purchaseSkuImmediately({
            type: 'NewMintUniqueAsset',
            skuId: skuId,
            userReferenceId: userReferenceId,
            quantity: 1,
          });
          document.getElementById('result').textContent = JSON.stringify(
            result,
            null,
            2,
          );
        } catch (error) {
          document.getElementById('result').textContent =
            'Error: ' + error.message;
        }
      }
    </script>
  </body>
</html>

